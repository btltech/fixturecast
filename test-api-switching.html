<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - DeepSeek vs Gemini</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .test-container { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; background: #2a2a2a; }
        .success { border-color: #4CAF50; background: #1B3B1B; }
        .error { border-color: #f44336; background: #3B1B1B; }
        .info { border-color: #2196F3; background: #1B1B3B; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; border: none; border-radius: 4px; }
        .primary { background: #2196F3; color: white; }
        .secondary { background: #4CAF50; color: white; }
        pre { background: #333; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .status { font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ü§ñ API Selection Test</h1>
    <p>This page tests which AI service is being used for predictions based on the environment.</p>

    <div class="test-container info">
        <h3>Environment Detection</h3>
        <div id="envInfo">
            <p><strong>Host:</strong> <span id="hostname"></span></p>
            <p><strong>Environment:</strong> <span id="environment"></span></p>
            <p><strong>Expected API:</strong> <span id="expectedAPI"></span></p>
        </div>
    </div>

    <div class="test-container">
        <h3>DeepSeek API Test</h3>
        <button class="secondary" onclick="testDeepSeek()">Test DeepSeek API</button>
        <div id="deepseekResult"></div>
    </div>

    <div class="test-container">
        <h3>Gemini API Test</h3>
        <button class="secondary" onclick="testGemini()">Test Gemini API</button>
        <div id="geminiResult"></div>
    </div>

    <div class="test-container">
        <h3>Prediction Generation Test</h3>
        <button class="primary" onclick="testPrediction()">Generate Test Prediction</button>
        <div id="predictionResult"></div>
    </div>

    <script>
        // Environment detection
        const hostname = window.location.hostname;
        const isLocal = hostname === 'localhost';
        
        document.getElementById('hostname').textContent = hostname;
        document.getElementById('environment').textContent = isLocal ? 'Local Development' : 'Production/Worker';
        document.getElementById('expectedAPI').textContent = isLocal ? 'DeepSeek' : 'Gemini';

        // Test DeepSeek API
        async function testDeepSeek() {
            const result = document.getElementById('deepseekResult');
            result.innerHTML = '<div class="status">Testing DeepSeek API...</div>';
            
            try {
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-8c8ce5fcb52a42559eb843b6515c565c'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{ role: 'user', content: 'Say: DeepSeek Test Success' }],
                        max_tokens: 20
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const content = data.choices?.[0]?.message?.content || 'No content';

                result.innerHTML = `
                    <div class="status" style="color: #4CAF50;">‚úÖ DeepSeek API Working</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                result.parentElement.className = 'test-container success';
            } catch (error) {
                result.innerHTML = `
                    <div class="status" style="color: #f44336;">‚ùå DeepSeek API Failed</div>
                    <pre>Error: ${error.message}</pre>
                `;
                result.parentElement.className = 'test-container error';
            }
        }

        // Test Gemini API
        async function testGemini() {
            const result = document.getElementById('geminiResult');
            result.innerHTML = '<div class="status">Testing Gemini API...</div>';
            
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=AIzaSyDMgbYEJ-rjGH_0R3lZaaTYT-DpW5NmXEc', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: 'Say: Gemini Test Success' }] }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const content = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No content';

                result.innerHTML = `
                    <div class="status" style="color: #4CAF50;">‚úÖ Gemini API Working</div>
                    <pre>Response: ${content}</pre>
                `;
                result.parentElement.className = 'test-container success';
            } catch (error) {
                result.innerHTML = `
                    <div class="status" style="color: #f44336;">‚ùå Gemini API Failed</div>
                    <pre>Error: ${error.message}</pre>
                `;
                result.parentElement.className = 'test-container error';
            }
        }

        // Test prediction generation (which service gets used)
        async function testPrediction() {
            const result = document.getElementById('predictionResult');
            result.innerHTML = '<div class="status">Generating test prediction...</div>';
            
            // This would normally use the app's prediction service
            // For now, just show which API should be used
            result.innerHTML = `
                <div class="status" style="color: #2196F3;">‚ÑπÔ∏è Prediction Test</div>
                <p>Environment: <strong>${isLocal ? 'Local Development' : 'Production'}</strong></p>
                <p>Expected Service: <strong>${isLocal ? 'DeepSeek' : 'Gemini'}</strong></p>
                <p>To test actual prediction generation, use the main app's prediction feature.</p>
            `;
        }
    </script>
</body>
</html>