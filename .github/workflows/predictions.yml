name: 🤖 Automated Prediction Generation
on:
  schedule:
    # Generate predictions every 6 hours at: 00:00, 06:00, 12:00, 18:00 UTC
    - cron: '0 */6 * * *'
  # Allow manual triggering
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual trigger'
        required: false
        default: 'Manual prediction update'

jobs:
  generate-predictions:
    runs-on: ubuntu-latest
    name: Generate Match Predictions
    
    steps:
      - name: 🔄 Generate Predictions
        run: |
          echo "🤖 Triggering prediction generation..."
          
          response=$(curl -s -w "\nHTTP_CODE:%{http_code}" -X POST \
            "https://fixturecast.pages.dev/api/update-predictions" \
            -H "Authorization: Bearer ${{ secrets.PREDICTION_API_KEY }}" \
            -H "Content-Type: application/json" \
            -H "User-Agent: GitHub-Actions-Cron/1.0")
          
          http_code=$(echo "$response" | grep "HTTP_CODE:" | cut -d: -f2)
          body=$(echo "$response" | sed '/HTTP_CODE:/d')
          
          echo "📊 Response Code: $http_code"
          echo "📋 Response Body: $body"
          
          if [ "$http_code" -eq 200 ]; then
            echo "✅ Predictions generated successfully!"
          else
            echo "❌ Prediction generation failed with code $http_code"
            exit 1
          fi

      - name: 📈 Log Results
        if: always()
        run: |
          echo "🕐 Cron job completed at $(date)"
          echo "⚽ Next prediction update in 6 hours"